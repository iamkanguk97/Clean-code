# 5장. 형식 맞추기

> 이 내용은 로버트 C. 마틴 저자님의 클린코드 책의 내용을 가져온 것입니다.

이번 글에서는 가독성이 좋다고 느끼기 위해 잘 갖춰져야 하는 형식에 대해서 알아보려고 한다. 형식을 맞추면서 코드를 작성하는게 중요하기 때문에 이번에도 집중해서 잘 배워보자.

### 형식을 맞추는 이유는?

가장 먼저 이야기 하고 싶은 것은 `코드 형식은 중요하다는 것`이다.

코드 형식은 의사소통의 일환이다. 개발자 협업에서 의사소통은 굉장히 중요한 부분이기 때문에 형식을 잘 갖춰서 코드를 작성하는 것이 의무가 되었다.

### 적절한 행 길이를 유지해야 한다

<img src="https://velog.velcdn.com/images/bami/post/e50075d2-f54f-4b3f-b64c-67446d92e05c/image.png" />

위의 그래프는 7개의 자바 프로젝트에 대한 평균 소스코드 길이를 보여준다. 그리고 네모를 관통하고 있는 세로 실선은 최대값과 최소값을 의미하고 있다.

나는 자바 개발자가 아니어서 잘 모르지만 그래도 JUnit, ant, tomcat은 들어본 적이 있다. 근데 위의 7개 프로젝트들은 거대하고 유명한 프로젝트라고 한다.

위의 사진을 보면 평균 코드 길이는 약 65줄이다. 파일 1개당 40~100줄 사이라는 것이다.

결론은 길게 작성된 코드보다 짧은 코드로 완성도가 있고 규모있는 프로젝트를 만들 수 있다는 것을 알자. `가장 중요한 것은 짧은 코드가 이해하기 더 쉽다는 것이다.`

#### 신문 기사처럼 작성해라

평소 우리는 신문 기사를 보게 되면 위에서 아래로 읽는다. 글 위에 기사 내용을 짧게 요약한 표제가 나오는데 나뿐만이 아니라 대부분의 독자들은 표제를 먼저 읽고 그 기사 내용을 읽을 지 말지 결정하게 된다.

**소스코드도 신문 기사와 비슷하게 작성하는 것이 좋다.** 이름은 간단하면서도 설명이 가능하게 짓는다. 소스 파일 첫 부분에는 고차원 개념과 알고리즘 설명을 적고, 아래로 갈수록 의도를 세세하게 표현하면 좋다. 그리고 마지막에는 저차원 함수와 세부 내역이 나온다.

#### 개념은 빈 행으로 분리하라

거의 모든 코드는 왼쪽에서 오른쪽으로, 위에서 아래로 읽는다. 각 행은 수식이나 절을 표현하고 일련의 행 묶음은 완결된 생각 하나를 표현한다. 그리고 생각과 생각 사이에는 빈 행을 넣어서 분리하는 것이 좋다.

빈 행을 넣는 것은 새로운 개념을 시작하는 시각적 단서다. 읽는 도중 빈 행을 보면 그 다음에 나오는 행에 자연스럽게 주목하게 될 것이다.

#### 세로 밀집도

**줄바꿈이 개념 분리를 의미**한다면 **세로 밀집도는 연관성을 의미**한다. `다시 말해서 서로 밀접한 코드 행은 세로로 가까이 놓아야 한다는 것이다.` 다른 개발자분이 작성해주신 코드가 있는데 참고를 한번 해보겠다.

```java
public List<Cell> getFlaggedCells() {
    List<Cell> flaggedCells = new ArrayList();

    List<Cell> dummyCells = new ArrayList();
    for (Cell cell : gameBoard)
        if (cell.isFlagged())
            flaggedCells.add(cell);
            dummyCells.add(cell);

    return flaggedCells;
}
```

위의 코드를 보면 `dummyCells` 변수가 for문 위에 붙어있다. 난 이런거 보면 너무너무 불편하다. 변수는 변수끼리 묶어두는게 개인적으로 너무 좋다.

```java
public List<Cell> getFlaggedCells() {
    List<Cell> flaggedCells = new ArrayList();
    List<Cell> dummyCells = new ArrayList();

    for (Cell cell : gameBoard)
        if (cell.isFlagged())
            flaggedCells.add(cell);
            dummyCells.add(cell);

    return flaggedCells;
}
```

이처럼 정렬하면 얼마나 좋은가..! 편-안하다

#### 수직 거리

> 서로 밀접한 개념은 한 파일에 두고 세로 거리로 연관성을 표시한다.

함수의 동작 방식과 연관 관계를 보면 소스 코드를 위아래로 뒤지게 된다. 진짜 꽤많은 시간과 노력을 들이게 된다. 그래서 이런 경우를 피하기 위해 밀접한 개념은 한 파일에 두는 것이 좋다.

그리고 서로 연관성이 깊은 함수끼리는 세로 거리를 가까이 두는게 좋다. 그렇지 않다면 함수를 찾기 위해 코드를 위아래로 뒤져봐야 하기 때문이다.

자바에서는 변수는 사용하는 위치에 최대한 가까이 두어야한다. 하지만 함수가 짧은 경우에는 지역 변수는 함수 맨위에 선언하도록 한다. 하지만 루프 변수(i,j,k)는 일반적으로 루프문 내부에서 선언하고 사용한다.

> 참고로 자바스크립트는 Hoisting으로 인해서 가급적이면 해당 블록의 최상단으로 올려쓰는 것이 좋다고 한다.

- `인스턴스 변수`는 클래스 맨 상단에 선언한다. 변수간 세로 거리를 따로 두지 않는다.
- `종속 함수`는 한 함수가 다른 함수를 호출하면 그 두 함수는 서로 붙여놓는다. 가능하다면 **호출하는 함수를 호출되는 함수보다 위에 놓는다.**
- `개념적 유사성`은 개념적인 친화도가 높다면 그 코드들은 서로 끌어당긴다. 그렇기에 친화도가 높을수록 가까이 배치한다. 친화도가 높아지는 요인에는 여러가지가 있는데 대표적으로 방금 전에 소개한 종속함수가 그 예다. 그리고 변수와 그 변수를 사용하는 함수, 비슷한 동작을 수행하는 함수들이 예가 될 수 있다.

#### 세로 순서

함수 호출 종속성은 아래 방향으로 유지한다. 즉, 호출되는 함수를 호출하는 함수보다 나중에 배치한다. 이렇게 하면 자연스럽게 소스코드 모듈이 고차원에서 저차원으로 자연스럽게 내려가게 된다.

기사처럼 중요한 개념을 표현할 때는 세세한 사항을 최대한 배제하며 가장 먼저 표현하도록 한다. 그렇게 하면 읽을 때 소스코드 파일에서 처음의 함수 몇 가지만읽어도 전체 내용을 파악할 수 있게 된다.

### 가로 형식 맞추기

<img src="https://velog.velcdn.com/images/bami/post/f5a12664-c997-47b2-8d4b-9a236f9f7b75/image.png" />

아까 위에서 세로 형식에서 봤던 7개 프로젝트를 이번에는 가로 길이로 분석한 표다. 표를 보면 약 `20~60자`인 행 수가 `1%대`를 차지하고 있다.

다시 말해서 전체 코드에서 약 40% 정도가 20~60자 사이를 갖고있다는 말이다. **따라서 대다수는 짧은 가로 길이를 사용하면서 좋은 프로젝트를 만들 수 있다는 것이다.**

#### 가로 공백과 밀집도

가로로는 공백을 사용해서 밀접한 개념과 느슨한 개념을 표현한다. 다른 블로그를 참고해서 가져와봤다.

```javascript
const add = (num1, num2) => {
  let result = 0;

  result = num1 + num2;

  return result;
};
```

화살표 함수의 인수 부분에서 쉼표 뒤에 공백을 주었다. 인수가 2개임을 확실하게 보여준다.
그리고 연산 부분에서도 연산자 사이에 앞뒤로 공백을 넣음으로써 피연산자와 연산자의 구분을 명확하게 해준다.

그리고 참고로 승수 사이에는 공백이 없다.

#### 가로 정렬

```java
public class ExampleClass {
	private   Player 	Player
  private   int       HealthPoint
  private   int       level;
  protected float     exp;
}
```

개인적으로 이 형태는 상당히 내가 좋아하지 않는 형태다. 어셈블리어 같은 가로 정렬은 엉뚱한 부분을 강조해서 진짜 의도가 가려지기 때문이다.

#### 들여쓰기

소스코드에서 스코프를 표현하기 위해서 들여쓰기를 이용하곤 한다. 들여쓰기는 내가 제일 잘하는 부분이기 때문에 따로 설명을 적지는 않도록 하겠다.

#### 가짜 범위

가끔가다가 빈 while, for를 만나게 되는데 이런 경우는 피하는 게 좋지만 피하지 못할 때에는 빈 블록으로 들여쓰고 괄호를 감싼다.

특히 while문에서 세미콜론은 새 행에 써서 넣는다.

### 팀 규칙

> 팀에 속해있다면 팀이 합의해서 정해진 규칙에 따라 코드를 작성해야 한다.

팀에 속한 팀원들은 반드시 팀에서 정한 규칙에 따라 소스코드를 작성해야 한다.

---

### 느낀점

솔직히 이번 장은 이해하기가 생각보다 어렵지 않았다. 뭔가 앞으로 프로젝트를 더 키워나가거나 새로 시작할 때 적용하기 쉬울 것 같다고 생각한다.

그리고 가장 해보고 싶은게 있었다. 위에서 언급한 `팀규칙`을 팀원들과 다같이 지켜보고 싶다는 생각이 항상 들었다.

사실 지금까지 백엔드를 협업해서 진행해본적이 없어서 그런 규칙같은게 없었다. 아무래도 개인으로 개발을 하다 보니까 규칙을 지키기가 쉽지는 않았던 것 같다.

앞으로 기회가 된다면 회사나 팀에 속해서 그런 규칙들을 지켜가면서 좋은 코드를 작성해보고 싶다는 생각을 했다.

### Reference

- https://velog.io/@bami/Clean-Code-5%EC%9E%A5-%ED%98%95%EC%8B%9D-%EB%A7%9E%EC%B6%94%EA%B8%B0
- https://effortguy.tistory.com/188
